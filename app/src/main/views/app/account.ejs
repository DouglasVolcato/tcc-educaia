<%- include('../partials/head', { title }) %>
  <body>
    <div class="d-flex flex-column min-vh-100">
      <%- include('../partials/navbar', { user, active: 'account', hideNavbar: false }) %>
      <main class="flex-grow-1">
        <div class="container d-flex flex-column gap-4">
          <header class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
            <div class="d-flex align-items-center gap-3">
              <img class="rounded-circle" src="<%= user.avatar %>" alt="Avatar de <%= user.name %>" width="72" height="72" />
              <div>
                <h1 class="h4 fw-bold mb-1"><%= user.name %></h1>
                <p class="text-secondary mb-0"><%= user.email %> • Plano <strong><%= user.plan %></strong></p>
              </div>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-outline-secondary"><i class="bi bi-download me-2"></i> Exportar dados</button>
              <button class="btn btn-danger"><i class="bi bi-box-arrow-right me-2"></i> Encerrar sessão</button>
            </div>
          </header>

          <section class="row g-4">
            <div class="col-12 col-xl-7">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-4 p-md-5 d-grid gap-4">
                  <div>
                    <h2 class="h5 fw-bold mb-1">Informações pessoais</h2>
                    <p class="text-secondary mb-0">Atualize seus dados e preferências de contato.</p>
                  </div>
                  <form class="d-grid gap-3" hx-put="/api/account" hx-target="#global-alert-container" hx-swap="beforeend">
                    <div class="row g-3">
                      <div class="col-md-6">
                        <label class="form-label fw-semibold" for="accountName">Nome completo</label>
                        <input class="form-control" type="text" id="accountName" name="name" value="<%= user.name %>" />
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-semibold" for="accountEmail">E-mail</label>
                        <input class="form-control" type="email" id="accountEmail" name="email" value="<%= user.email %>" />
                      </div>
                    </div>
                    <div class="row g-3">
                      <div class="col-md-6">
                        <label class="form-label fw-semibold" for="accountTimezone">Fuso horário</label>
                        <select class="form-select" id="accountTimezone" name="timezone">
                          <option value="America/Sao_Paulo" <%= user.timezone === 'America/Sao_Paulo' ? 'selected' : '' %>>São Paulo</option>
                          <option value="America/Manaus" <%= user.timezone === 'America/Manaus' ? 'selected' : '' %>>Manaus</option>
                          <option value="America/Fortaleza" <%= user.timezone === 'America/Fortaleza' ? 'selected' : '' %>>Fortaleza</option>
                          <option value="America/Recife" <%= user.timezone === 'America/Recife' ? 'selected' : '' %>>Recife</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-semibold" for="dailyGoal">Meta diária</label>
                        <input class="form-control" type="number" id="dailyGoal" name="goal" value="<%= user.goalPerDay %>" />
                      </div>
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                      <button type="button" class="btn btn-outline-secondary">Cancelar</button>
                      <button type="submit" class="btn btn-primary" data-loading-button>
                        <span data-loading-label>Salvar alterações</span>
                        <span class="d-none" data-loading-spinner>
                          <span class="spinner-border spinner-border-sm align-middle" role="status" aria-hidden="true"></span>
                          <span class="ms-2">Salvando...</span>
                        </span>
                      </button>
                    </div>
                  </form>
                  <div>
                    <h3 class="h6 text-uppercase text-secondary fw-semibold">Preferências de notificação</h3>
                    <form class="d-grid gap-2" hx-put="/api/account/preferences" hx-target="#global-alert-container" hx-swap="beforeend">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="prefEmail" name="reminderEmail" <%= preferences.reminderEmail ? 'checked' : '' %> />
                        <label class="form-check-label" for="prefEmail">Lembretes por e-mail</label>
                      </div>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="prefPush" name="reminderPush" <%= preferences.reminderPush ? 'checked' : '' %> />
                        <label class="form-check-label" for="prefPush">Notificações push</label>
                      </div>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="prefSummary" name="weeklySummary" <%= preferences.weeklySummary ? 'checked' : '' %> />
                        <label class="form-check-label" for="prefSummary">Resumo semanal</label>
                      </div>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="prefAI" name="aiSuggestions" <%= preferences.aiSuggestions ? 'checked' : '' %> />
                        <label class="form-check-label" for="prefAI">Sugestões automáticas da IA</label>
                      </div>
                      <button type="submit" class="btn btn-outline-primary align-self-start mt-2" data-loading-button>
                        <span data-loading-label>Atualizar preferências</span>
                        <span class="d-none" data-loading-spinner>
                          <span class="spinner-border spinner-border-sm align-middle" role="status" aria-hidden="true"></span>
                          <span class="ms-2">Salvando...</span>
                        </span>
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-xl-5">
              <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-4 p-md-5 d-grid gap-4">
                  <div>
                    <h2 class="h5 fw-bold mb-1">Integrações conectadas</h2>
                    <p class="text-secondary mb-0">Conecte suas ferramentas favoritas para sincronia automática.</p>
                  </div>
                  <div class="d-flex flex-column gap-3">
                    <% integrations.forEach(function(integration) { %>
                      <div class="d-flex justify-content-between align-items-center border rounded-4 px-3 py-3">
                        <div>
                          <p class="fw-semibold mb-1"><%= integration.name %></p>
                          <span class="badge <%= integration.connected ? 'text-bg-success' : 'text-bg-secondary' %> pill">
                            <%= integration.connected ? 'Conectado' : 'Desconectado' %>
                          </span>
                        </div>
                        <button class="btn btn-outline-primary" type="button">
                          <%= integration.connected ? 'Gerenciar' : 'Conectar' %>
                        </button>
                      </div>
                    <% }) %>
                  </div>
                  <div class="border-top pt-3">
                    <p class="text-secondary small mb-1"><i class="bi bi-shield-lock me-1"></i> Segurança em primeiro lugar</p>
                    <p class="mb-0">Todos os dados são criptografados e você pode revogar o acesso a qualquer momento.</p>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
      <%- include('../partials/footer') %>
    </div>
    <%- include('../partials/feedback') %>
  <%- include('../partials/scripts') %>
