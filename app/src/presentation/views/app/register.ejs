<%- include('../partials/head', { title }) %>
  <body class="bg-light">
    <div class="d-flex flex-column min-vh-100">
      <%- include('../partials/navbar', { hideNavbar: true }) %>
      <main class="container flex-grow-1 py-5">
        <div class="row justify-content-center g-5">
          <div class="col-xl-5">
            <div class="card border-0 shadow-sm rounded-4 p-4 p-md-5">
              <div class="mb-4">
                <span class="d-inline-block fw-bold text-success small mb-1">EducaIA</span>
                <span class="badge bg-success-subtle text-success pill mb-2">Comece gratuito</span>
                <h2 class="fw-bold">Criar minha conta</h2>
                <p class="text-secondary mb-0">
                  Crie baralhos personalizados, gere flashcards com IA e acompanhe sua evolução dia após dia.
                </p>
              </div>
              <% if (googleClientId) { %>
                <div class="d-grid gap-2 mb-3" id="google-signin-wrapper">
                  <div id="google-signin-button"></div>
                </div>
              <% } %>
              <div class="mt-4 pt-4 text-center">
                <p class="mb-1 text-secondary">Já possui conta?</p>
                <a class="fw-semibold" href="/app/login">Entrar com meu e-mail</a>
              </div>
            </div>
          </div>
          <div class="col-xl-5 d-none d-xl-flex">
            <div class="card hero-card w-100 rounded-5 p-5 text-white">
              <div class="d-flex flex-column gap-4">
                <div>
                  <span class="display-6 fw-bold text-white">EducaIA</span>
                  <h3 class="fw-bold mb-3">Tudo para acelerar seu aprendizado</h3>
                  <p class="mb-0 opacity-75">
                    Geração automática de flashcards, plano de revisão inteligente, importação de conteúdo e dashboards completos.
                  </p>
                </div>
                <div class="bg-white bg-opacity-10 rounded-4 p-4">
                  <h4 class="h6 text-uppercase opacity-75">Resultados recentes</h4>
                  <div class="d-flex flex-wrap gap-4">
                    <div>
                      <span class="d-block fs-4 fw-bold">+186</span>
                      <span class="small text-uppercase">Cartas revisadas</span>
                    </div>
                    <div>
                      <span class="d-block fs-4 fw-bold">87%</span>
                      <span class="small text-uppercase">Taxa de acertos</span>
                    </div>
                  </div>
                </div>
                <div class="d-flex flex-column gap-2">
                  <div class="d-flex align-items-center gap-3">
                    <span class="badge bg-light text-primary pill">IA copiloto</span>
                    <span class="opacity-75">Cria flashcards a partir de qualquer texto</span>
                  </div>
                  <div class="d-flex align-items-center gap-3">
                    <span class="badge bg-light text-primary pill">Organização</span>
                    <span class="opacity-75">Baralhos por assunto com indicadores de revisão</span>
                  </div>
                  <div class="d-flex align-items-center gap-3">
                    <span class="badge bg-light text-primary pill">Resultados</span>
                    <span class="opacity-75">Acompanhe seu desempenho em gráficos intuitivos</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <%- include('../partials/footer') %>
    </div>
    <%- include('../partials/feedback') %>
    <% if (googleClientId) { %>
      <script src="https://accounts.google.com/gsi/client" async defer></script>
      <script>
        (() => {
          const clientId = "<%= googleClientId %>";
          if (!clientId || typeof window === "undefined") return;

          const renderButton = () => {
            if (!window.google?.accounts?.id) {
              window.setTimeout(renderButton, 150);
              return;
            }

            window.google.accounts.id.initialize({
              client_id: clientId,
              callback: handleGoogleCredentialResponse,
            });

            const target = document.getElementById("google-signin-button");
            const wrapper = document.getElementById("google-signin-wrapper");
            if (target) {
              const availableWidth =
                wrapper?.getBoundingClientRect().width || target.parentElement?.clientWidth || 320;
              const width = Math.max(240, Math.min(availableWidth, 400));

              target.innerHTML = "";
              window.google.accounts.id.renderButton(target, {
                type: "standard",
                theme: "outline",
                size: "large",
                text: "continue_with",
                width,
              });
            }
          };

          const showToast = (markup) => {
            const container = document.querySelector("#global-alert-container");
            if (container && markup) {
              container.insertAdjacentHTML("beforeend", markup);
            }
          };

          window.handleGoogleCredentialResponse = async (response) => {
            const container = document.querySelector("#global-alert-container");
            if (container) {
              container.innerHTML = "";
            }

            try {
              const res = await fetch("/api/auth/google", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ credential: response?.credential }),
              });

              const markup = await res.text();
              showToast(markup);

              const redirect = res.headers.get("HX-Redirect");
              if (res.ok && redirect) {
                window.location.href = redirect;
              }
            } catch (error) {
              showToast(
                `<div class="toast show align-items-center text-bg-danger border-0 shadow" role="alert" aria-live="assertive" aria-atomic="true"><div class="d-flex"><div class="toast-body">Não foi possível conectar com o Google. Tente novamente.</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Fechar"></button></div></div>`,
              );
            }
          };

          let resizeTimeout;
          window.addEventListener("resize", () => {
            window.clearTimeout(resizeTimeout);
            resizeTimeout = window.setTimeout(renderButton, 150);
          });

          renderButton();
        })();
      </script>
    <% } %>
  <%- include('../partials/scripts') %>
