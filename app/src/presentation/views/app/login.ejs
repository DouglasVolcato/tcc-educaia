<%- include('../partials/head', { title }) %>
  <body class="bg-light">
    <div class="d-flex flex-column min-vh-100">
      <%- include('../partials/navbar', { hideNavbar: true }) %>
      <main class="container flex-grow-1 d-flex align-items-center justify-content-center">
        <div class="row w-100 align-items-center g-5">
          <div class="col-lg-6 d-none d-lg-block">
            <div class="hero-card rounded-5 p-5 text-white">
              <div class="d-inline-flex align-items-center gap-3 mb-3">
                <span class="display-6 fw-bold text-white">EducaIA</span>
                <span class="badge bg-white text-primary pill text-uppercase">Aprenda com IA</span>
              </div>
              <h1 class="display-5 fw-bold">Bem-vindo de volta!</h1>
              <p class="lead opacity-75 mb-4">
                Revise seus flashcards com a ajuda da inteligência artificial, acompanhe o progresso e alcance seus objetivos de estudo.
              </p>
              <ul class="list-unstyled opacity-75 mb-5">
                <li class="d-flex align-items-center gap-2 mb-2"><i class="bi bi-check-circle-fill"></i> Planejamento inteligente</li>
                <li class="d-flex align-items-center gap-2 mb-2"><i class="bi bi-check-circle-fill"></i> Importação de conteúdo em segundos</li>
                <li class="d-flex align-items-center gap-2"><i class="bi bi-check-circle-fill"></i> Indicadores de performance em tempo real</li>
              </ul>
              <div class="d-flex gap-2">
                <a class="btn btn-outline-light btn-lg" href="/app/register">Criar uma conta</a>
              </div>
            </div>
          </div>
          <div class="col-lg-5 ms-lg-auto">
            <div class="card border-0 shadow-sm rounded-4 p-4 p-md-5">
              <div class="mb-4 text-center">
                <span class="d-inline-block fw-bold text-primary small mb-1">EducaIA</span>
                <span class="badge bg-primary-subtle text-primary pill mb-2">Acesse sua conta</span>
                <h2 class="fw-bold">Entrar</h2>
                <p class="text-secondary mb-0">Use seu e-mail e senha cadastrados.</p>
              </div>
              <% if (googleClientId) { %>
                <div class="d-grid gap-2 mb-3" id="google-signin-wrapper">
                  <div id="google-signin-button"></div>
                  <p class="text-secondary small mb-0">Usaremos apenas seu nome e e-mail.</p>
                </div>
                <div class="d-flex align-items-center gap-2 text-secondary text-uppercase small mb-3">
                  <div class="flex-grow-1 border-top"></div>
                  <span>ou</span>
                  <div class="flex-grow-1 border-top"></div>
                </div>
              <% } %>
              <form
                class="d-grid gap-3"
                hx-post="/api/auth/login"
                hx-target="#global-alert-container"
                hx-swap="beforeend"
                data-loading-overlay="true"
              >
                <div>
                  <label class="form-label fw-semibold" for="email">E-mail</label>
                  <input
                    class="form-control form-control-lg"
                    type="email"
                    name="email"
                    id="email"
                    placeholder="seuemail@exemplo.com"
                    required
                  />
                </div>
                <div>
                  <div class="d-flex justify-content-between align-items-center">
                    <label class="form-label fw-semibold" for="password">Senha</label>
                    <a class="small link-primary text-decoration-none" href="#">Esqueci minha senha</a>
                  </div>
                  <input
                    class="form-control form-control-lg"
                    type="password"
                    name="password"
                    id="password"
                    placeholder="Digite sua senha"
                    minlength="6"
                    required
                  />
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="true" id="remember" name="remember" />
                  <label class="form-check-label" for="remember">Permanecer conectado</label>
                </div>
                <button type="submit" class="btn btn-primary btn-lg" data-loading-button>
                  <span data-loading-label>Entrar</span>
                  <span class="d-none" data-loading-spinner>
                    <span class="spinner-border spinner-border-sm align-middle" role="status" aria-hidden="true"></span>
                    <span class="ms-2">Entrando...</span>
                  </span>
                </button>
              </form>
              <div class="border-top mt-4 pt-4 text-center">
                <p class="mb-1 text-secondary">Ainda não tem conta?</p>
                <a class="fw-semibold" href="/app/register">Comece agora gratuitamente</a>
              </div>
            </div>
          </div>
        </div>
      </main>
      <%- include('../partials/footer') %>
    </div>
    <%- include('../partials/feedback') %>
    <% if (googleClientId) { %>
      <script src="https://accounts.google.com/gsi/client" async defer></script>
      <script>
        (() => {
          const clientId = "<%= googleClientId %>";
          if (!clientId || typeof window === "undefined") return;

          const renderButton = () => {
            if (!window.google?.accounts?.id) {
              window.setTimeout(renderButton, 150);
              return;
            }

            window.google.accounts.id.initialize({
              client_id: clientId,
              callback: handleGoogleCredentialResponse,
            });

            const target = document.getElementById("google-signin-button");
            if (target) {
              window.google.accounts.id.renderButton(target, {
                type: "standard",
                theme: "outline",
                size: "large",
                text: "continue_with",
                width: 340,
              });
            }
          };

          const showToast = (markup) => {
            const container = document.querySelector("#global-alert-container");
            if (container && markup) {
              container.insertAdjacentHTML("beforeend", markup);
            }
          };

          window.handleGoogleCredentialResponse = async (response) => {
            const container = document.querySelector("#global-alert-container");
            if (container) {
              container.innerHTML = "";
            }

            try {
              const res = await fetch("/api/auth/google", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ credential: response?.credential }),
              });

              const markup = await res.text();
              showToast(markup);

              const redirect = res.headers.get("HX-Redirect");
              if (res.ok && redirect) {
                window.location.href = redirect;
              }
            } catch (error) {
              showToast(
                `<div class="toast show align-items-center text-bg-danger border-0 shadow" role="alert" aria-live="assertive" aria-atomic="true"><div class="d-flex"><div class="toast-body">Não foi possível conectar com o Google. Tente novamente.</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Fechar"></button></div></div>`,
              );
            }
          };

          renderButton();
        })();
      </script>
    <% } %>
  <%- include('../partials/scripts') %>
